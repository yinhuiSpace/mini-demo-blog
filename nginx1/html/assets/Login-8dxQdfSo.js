import{e as u,m as g,a as x,E as p,l as L,d as R,c as E,h as V,b as t,w as a,r,n as N,o as w,p as j,u as l,j as D,k as y,q as S}from"./index-D4dsPctk.js";const o=u({username:"",password:"",verifyCode:""}),b=u({username:[{required:!0,message:"请填写用户名",trigger:"blur"}],password:[{required:!0,message:"请填写密码",trigger:"blur"}],verifyCode:[{required:!0,message:"验证码不能为空",trigger:"blur"}]}),c=u({}),i=u(!1),n=u(!1),T=d=>{g().removeLogin(),d.validate(m=>{if(m)return i.value=!0,x.post("/auth-service/auth/login",o.value).then(e=>{e.data.isSuccess?(n.value=!1,i.value=!1,g().token=e.data.content.token,g().userInfo=e.data.content.infoVo,p.success("登录成功"),o.value={username:"",password:""},L.push({path:"/"}).then()):(p.error(e.data.message),n.value=!1,i.value=!1),i.value=!1});n.value=!1,p.error("请按要求填写")})},$=()=>{n.value=!0,o.value.username===null||o.value.username.trim().length===0?p.error("请按要求填写用户名密码"):F()},F=()=>{x.post("/auth-service/auth/verifyCode",{username:o.value.username},{responseType:"arraybuffer"}).then(d=>{if(d.data){const m=new Blob([d.data],{type:"image/png"});k.value=URL.createObjectURL(m)}})},k=u(""),M={class:"columns py-6"},O={class:"column is-half is-offset-one-quarter"},z=V("div",{class:"el-header has-text-centered has-text-weight-bold"}," 登录 ",-1),G=R({__name:"Login",setup(d){return(m,e)=>{const _=r("el-input"),f=r("el-form-item"),v=r("el-button"),C=r("router-link"),h=r("el-form"),U=r("el-image"),q=r("el-dialog"),B=r("el-card"),I=N("loading");return w(),E("div",M,[V("div",O,[t(B,{shadow:"never"},{default:a(()=>[z,j((w(),D(h,{model:l(o),ref_key:"formInstance",ref:c,rules:l(b),"label-width":"100px",class:"","status-icon":"",style:{width:"80%"}},{default:a(()=>[t(f,{label:"用户名",prop:"username"},{default:a(()=>[t(_,{modelValue:l(o).username,"onUpdate:modelValue":e[0]||(e[0]=s=>l(o).username=s),autocomplete:"off",type:"text","prefix-icon":"user"},null,8,["modelValue"])]),_:1}),t(f,{label:"密码",prop:"password"},{default:a(()=>[t(_,{modelValue:l(o).password,"onUpdate:modelValue":e[1]||(e[1]=s=>l(o).password=s),type:"password","show-password":"",autocomplete:"off","prefix-icon":"lock"},null,8,["modelValue"])]),_:1}),t(f,null,{default:a(()=>[t(v,{type:"primary",onClick:e[2]||(e[2]=s=>l($)(l(c))),plain:""},{default:a(()=>[y(" 登录 ")]),_:1}),t(C,{to:"/register"},{default:a(()=>[t(v,{type:"danger",style:{"margin-left":"20px"},plain:""},{default:a(()=>[y(" 注册 ")]),_:1})]),_:1})]),_:1})]),_:1},8,["model","rules"])),[[I,l(i)]]),t(q,{modelValue:l(n),"onUpdate:modelValue":e[5]||(e[5]=s=>S(n)?n.value=s:null),title:"验证码",width:"400","align-center":""},{default:a(()=>[t(h,{model:l(o),ref_key:"formInstance",ref:c,rules:l(b)},{default:a(()=>[t(f,{label:"验证码",prop:"code",style:{display:"flex"}},{default:a(()=>[t(_,{style:{flex:"1"},modelValue:l(o).verifyCode,"onUpdate:modelValue":e[3]||(e[3]=s=>l(o).verifyCode=s),placeholder:"请输入验证码"},null,8,["modelValue"]),t(U,{src:l(k),fit:"fill",style:{flex:"1",height:"40px"}},null,8,["src"])]),_:1}),t(v,{type:"primary",onClick:e[4]||(e[4]=s=>l(T)(l(c)))},{default:a(()=>[y(" 确定 ")]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["modelValue"])]),_:1})])])}}});export{G as default};
