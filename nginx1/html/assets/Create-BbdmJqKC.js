import{V as O}from"./index-CcLFBvZZ.js";import{d as T,e as d,g as $,E as n,a as p,j as g,w as l,r as c,n as A,o as m,k as b,p as L,b as o,h as z,c as V,i as G,F as H,u as K,s as P,l as Q}from"./index-D4dsPctk.js";const R=["src"],Z=T({__name:"Create",setup(W){const s=d({title:"",content:"",tags:[],categoryId:"",thumbnail:"",summary:"",status:1}),v=d(),u=d(!1),k=t=>{t.validate(e=>{e?(u.value=!0,s.value.content=v.value.getValue(),p.post("/blog-service/article",s.value).then(a=>{a.data.isSuccess?(n.success("保存成功"),u.value=!1):(n.error(a.data.message),u.value=!1)})):n.error("请按照要求编写文章")})},w=t=>{t.validate(e=>{e?(u.value=!0,p.post("/blog-service/article",s.value).then(a=>{a.data.isSuccess?(n.success("发布成功"),u.value=!1,Q.replace({path:"/"})):(n.error(a.data.message),u.value=!1)})):n.error("请按照要求编写文章")})},f=d(),x=d({title:[{required:!0,message:"标题不能为空",trigger:"blur"},{min:2,max:20,message:"标题长度必须控制在2-20个字符",trigger:"blur"}],summary:[{required:!0,message:"摘要不能为空",trigger:"blur"},{min:2,max:50,message:"摘要长度必须控制在2-50个字符",trigger:"blur"}],content:[{required:!0,message:"内容不能为空",trigger:"blur"}],categoryId:[{required:!0,message:"文章分区不能为空",trigger:"blur"}],thumbnail:[{required:!0,message:"文章封面不能为空",trigger:"blur"}]});$(()=>{I(),v.value=new O("vditor",{height:"60vh",width:"100vw",placeholder:"文章内容",theme:"classic",counter:{enable:!0,type:"markdown"},preview:{delay:0,hljs:{style:"monokai",lineNumber:!0}},tab:"	",typewriterMode:!0,toolbarConfig:{pin:!0},cache:{enable:!1},mode:"sv",upload:{url:"http://localhost:15000/blog-service/upload/img",accept:"image/*",fieldName:"blogImg",token:"token",multiple:!1,max:2*1024*1024,filename(t){return t},format(t,e){console.log(t[0]);const a=JSON.parse(e);if(a.isSuccess){const i=a.content;return JSON.stringify({code:0,data:{errFiles:"",succMap:{[t[0].name]:i}}})}else n(a.message)}}})});const I=()=>{p.get("/blog-service/category").then(t=>{t.data.isSuccess?h.value=t.data.content:n.error(t.data.message)})},h=d([]),C=()=>{s.value.content=v.value.getValue()},S=()=>{n.success("上传成功")},_=d(""),N=t=>{u.value=!0;const e=new FormData;e.append("blogImg",t.file),p.post("/blog-service/upload/img",e).then(a=>{a.data.isSuccess?(s.value.thumbnail=a.data.content,_.value=a.data.content,n.success("上传成功"),u.value=!1):(n.error(a.data.message),u.value=!1)})},q=d({"Content-Type":"multipart/form-data"});return(t,e)=>{const a=c("el-input"),i=c("el-form-item"),F=c("b-taginput"),U=c("el-option"),B=c("el-select"),D=c("el-icon"),M=c("el-upload"),y=c("el-button"),E=c("el-form"),j=c("el-card"),J=A("loading");return m(),g(j,null,{header:l(()=>[b(" 新增文章 ")]),default:l(()=>[L((m(),g(E,{model:s.value,rules:x.value,ref_key:"formInstance",ref:f},{default:l(()=>[o(i,{prop:"title"},{default:l(()=>[o(a,{modelValue:s.value.title,"onUpdate:modelValue":e[0]||(e[0]=r=>s.value.title=r),placeholder:"请输入文章标题"},null,8,["modelValue"])]),_:1}),o(i,{prop:"content"},{default:l(()=>[z("div",{id:"vditor",onInput:C},null,32)]),_:1}),o(i,null,{default:l(()=>[o(F,{modelValue:s.value.tags,"onUpdate:modelValue":e[1]||(e[1]=r=>s.value.tags=r),class:"my-3",maxlength:"15",maxtags:"5",ellipsis:"",placeholder:"请输入文章标签",style:{width:"100vw"}},null,8,["modelValue"])]),_:1}),o(i,{prop:"summary",label:"文章摘要"},{default:l(()=>[o(a,{type:"textarea",autocomplete:"off",modelValue:s.value.summary,"onUpdate:modelValue":e[2]||(e[2]=r=>s.value.summary=r),minlength:"2",maxlength:"50",placeholder:"请输入文章摘要"},null,8,["modelValue"])]),_:1}),o(i,{prop:"categoryId",label:"文章分区"},{default:l(()=>[o(B,{modelValue:s.value.categoryId,"onUpdate:modelValue":e[3]||(e[3]=r=>s.value.categoryId=r),clearable:"",placeholder:"选择分区",style:{width:"240px"}},{default:l(()=>[(m(!0),V(H,null,G(h.value,r=>(m(),g(U,{key:r.value,label:r.name,value:r.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),o(i,{prop:"thumbnail",label:"文章封面"},{default:l(()=>[o(M,{class:"avatar-uploader",action:"","show-file-list":!1,"on-success":S,"http-request":N,headers:q.value},{default:l(()=>[_.value?(m(),V("img",{key:0,src:_.value,class:"avatar",alt:""},null,8,R)):(m(),g(D,{key:1,class:"avatar-uploader-icon"},{default:l(()=>[o(K(P))]),_:1}))]),_:1},8,["headers"])]),_:1}),o(i,null,{default:l(()=>[o(y,{type:"primary",onClick:e[4]||(e[4]=r=>w(f.value))},{default:l(()=>[b(" 发布文章 ")]),_:1}),o(y,{type:"danger",onClick:e[5]||(e[5]=r=>k(f.value)),class:"ml-2"},{default:l(()=>[b(" 保存草稿 ")]),_:1})]),_:1})]),_:1},8,["model","rules"])),[[J,u.value]])]),_:1})}}});export{Z as default};
